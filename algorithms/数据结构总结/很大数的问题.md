# 1.如何在 1000 万个整数中快速查找某个整数？

- 内存限制是 100MB，每个数据大小是 8 字节

1. 最简单的办法就是将数据存储在数组中，内存占用差不多是 80MB，符合内存的限制。- 

   - 先对这 1000 万数据从小到大排序，然后再利用二分查找算法，就可以快速地查找想要的数据。

2. **散列表和二叉树不能解决这个问题**

   虽然大部分情况下，用二分查找可以解决的问题，用散列表、二叉树都可以解决。

   但是，不管是散列表还是二叉树，都会需要比较多的额外的内存空间。如果用散列表或者二叉 树来存储这 1000 万的数据，用 100MB 的内存肯定是存不下的。

   而二分查找底层依赖的是数组，除了数据本身之外，不需要额外存储其他信息，是最省内存空间的存储方式，所以刚好能在限定的内存大小下解决这个问题。

# 2.如何在100 亿URL中判断某个URL是否存在？

一个网站有 100 亿 url 存在一个黑名单中，每条 url 平均 64 字节。问这个黑名单要怎么存？若此时随便输入一个 url，如何判断该 url 是否在这个黑名单中？ 

1. 如果把黑名单看成一个集合，将其存在 hashmap 中，貌似太大了，需要 640G，明显不科学。 

2. **布隆过滤器**

   它实际上是一个很长的二进制矢量和一系列随机映射函数。布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都远远超过一般的算法，缺点是有一定的误识别率和删除困难。 

##  **布隆过滤器**

布隆过滤器实际上是一个很长的二进制矢量和一系列随机映射函数。

**很长的二进制矢量**：这是一个长度很长的数组，什么类型的数组呢？

bit 类型的数组，也是我们说的「位」，（1Byte = 8bit，1KB = 1024Byte）。

**一系列随机映射函数**：有多个哈希函数。那什么是哈希函数呢？

JDK 里面有计算得到哈希值的方法，那就是一个哈希函数。

布隆过滤器可以用于检索一个元素是否在一个集合中。

**优点**是：空间效率和查询时间都远远超过一般的算法，

**缺点是**：有一定的误识别率和删除困难

## 做法：

假设，bit 类型数组的长度为 m，每个元素值为 0，有 k 个哈希函数。

首先，当输入一个 url 的时候，此时这个 url 会经过 k 个哈希函数处理，得到多个哈希值（v1,v2,...,vk）。之后分别将这些哈希值除以数组的长度 m，和对 m 取模，得到这些哈希值对应在数组的下标位置，最后将这些下标的元素都置为 1。

![img](C:/Users/PennyLiu/AppData/Local/YNote/data/liurqbupt@163.com/c90090f9c35840938e8b8e49e735e88e/54e89ebc962e4839bca5225723d4f01e.jpeg)

那么如何判断一个 url 在黑名单里面呢？输入一条 url，它经过上述处理之后，会得到多个数组的下标位置。如果这些下标的元素值都已经为 1 了，说明该在黑名单里面，否则不在。

总体就是这样的流程，下面说下大家可能存在的疑问：

1、bit 类型的数组如何构建

2、得到 v1,v2,...,vk 这些哈希值后，如何得到其在数组的下标位置，并将其设置为 1 呢？

两个问题我一起说下，Java 里面没有 bit 这样的类型，怎么构建呢？—— 不难，我们可以使用 int，一个 int 是 32 位。

```
//创建了一个 100 * 32bit 的数组
int[] arr = new int[100]; 
// 代表 bit 数组 0-31 位的元素
arr[0];
```

因此上面再会说「分别将这些哈希值除以数组的长度 m，和对 m 取模，得到这些哈希值对应在数组的下标位置」。

```java
具体我们可以拿一个哈希值 data 来举个栗子，假设 int 数组长度为 100。
void Set(int data) {
     // ByteNO 是表示在 table 数组中那个元素
       int ByteNo = data / 100;
     // bitNo 是表示在 32 位 bit 中哪个 bit 位。
	   int BitNo = data % 32;
	// 置 1
	    _table[ByteNo] |= (1 << BitNo); 
   }
```

4. 使用效果

最开始我们提到，如果将 100 亿 url 放到 HashMap 中需要 640GB，那么使用布隆过滤器后又需要多少空间呢？答案是约等于 23 GB。相比之下，这个空间大小是不是就可以接受很多了。

5. 缺点

布隆过滤器有宁可错杀一百，也不能放过一个的性质。讲人话就是属于黑名单的 url 一定能够正确判断它在黑名单中，但不属于黑名单中的 url 也可能会被认为在黑名单中，存在一定的失误率。

至于失误率要保持在多少，数组长度，哈希函数的个数分别要设置多少就需要根据实际情况来选择了，网上有对应的数学公式计算，这里就不展开讲了。

# 3.如何在10亿数中找出前1000大的数？

