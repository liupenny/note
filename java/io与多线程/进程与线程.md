# 进程与线程

## 进程

### 定义

在多任务系中，每一个独立运行的程序就是一个进程，也可以理解为当前正在运行的每一个程序都是一个进程。

### 组成

1. **至少一个可执行程序**，包括代码和初始数据，一般在进程创建时说明。注意可执行程序可以被多进程共享。 

2. **一个独立的进程空间** ，在进程创建时由操作系统分配。 

3. **系统资源**，指在进程创建时及执行过程中，由操作系统分配给进程的系统资源，包括I/O设备、文件等。 

4. **一个执行栈区** ，包含运行现场信息，如子程序调用时所压的栈帧、系统调用时所压的栈帧等

   > 用户栈：进程创建时在用户进程空间定义，用来在用户态运行时保存用户程序现场
   >
   > 核心栈：在操作系统核心空间分配，用来保存中断/异常点现场及在进程运行核态程序后的转子现场

### PCB

操作系统为了管理和控制一个进程必须建立一个表格，描述该进程的存在及状态。这个表格被称为进程控制块（Process Control Block，PCB），存放进程标识、空间、运行状态、资源使用等信息。

### 状态转换

![image](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1490762862437&di=37cd64a8730b3b4ad91abc9313f0f9a2&imgtype=0&src=http%3A%2F%2Fimg0.ph.126.net%2F0EAGc-zpq2O6075rs15QSg%3D%3D%2F6598002152516532030.jpg)

## 线程

### 状态

- 新创建（new）：尚未运行，准备工作
- 可运行（runnable）：可能在运行，取决于操作系统给线程的运行时间，抢占式调度采用时间片机制
- 被阻塞（blocked）：尝试获取被其他对象持有的对象锁，直到其他线程释放
- 等待（waiting）：等待其他线程通知调度器一个条件，与Object.wait和Thread.join有关
- 计时等待（timed wating）：保持等待直到超时或接收到通知
- 被终止（terminated）：run方法正常退出或出现异常意外退出

为了减少程序再并发执行时所付出的时空开销，使OS具有更好的并发性。**线程是“进程”中某个单一顺序的控制流，也被称为轻量进程**

### 与进程的对比

1. **调度**。进程是资源拥有的基本单位，线程是调度和分派的基本单位。
2. **并发性**。进程之间可以并发执行，在一个进程中的多个线程之间也可以并发执行。
3. **拥有资源**。 进程可以拥有资源，是系统中拥有资源的一个基本单位。而线程自己不拥有系统资源，但它可以访问其隶属进程的资源。
4. **系统开销** 系统创建进程需要为该进程重新分配系统资源，但创建线程的代价很小。因此多线程的实现多任务并发比多进程实现并发的效率高